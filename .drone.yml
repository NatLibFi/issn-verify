---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true      
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  #- name: check-coverage
  #  image: node:12
  #  commands:
  #    - npm run coverage

  - name: build
    image: node:12
    commands:
      #- npm run build
      - NPM_CONFIG_IGNORE_SCRIPTS=true npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      #- njsscan dist
      - njsscan issnVerify.js

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag 
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: 0KrBO2f7mfXKttC9OJv9T8448t7HjKT8vP5Yda1uyTSiz66kYJE7A9h3qyKMJxQvAbBEPgYF6sxDQFQ0Jr2/jg==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 4b9e14dba0182b7bfefc5c42fcdbe781e362f0b792df862d2e862beab51958a6

...
